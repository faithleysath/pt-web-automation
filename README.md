# PT-Web-Automation

基于Web的全自动PT发种工具

## 项目概述

PT-Web-Automation是一个自动化工具，用于管理视频内容的订阅、下载、打包和发布到PT站点的完整流程。本工具支持剧集元数据管理、多平台内容订阅、自动下载、文件处理和种子制作发布等功能。

## 功能特性

### 剧集元数据管理
- 支持完整的剧集信息管理，包括标题、原始标题、豆瓣ID、IMDB ID等
- 自动抓取和手动修改元数据
- 支持电影和剧集两种类型

### 内容订阅系统
- 多OTT平台订阅支持
- 基于Cron的定时更新策略
- 订阅状态自动跟踪（更新中/已完结/已打包）

### 自动下载功能
- 自动检测缺失剧集
- 从OTT平台获取下载链接
- 失败重试机制
- 标准化的下载目录结构

### 文件处理系统
- 新文件自动检测
- 智能重命名和文件转移
- 自动种子制作

### 发布系统
- 自动发布到PT站点
- 分集/全集发布支持
- 发布状态跟踪和失败重试
- 自动添加到客户端做种

## 系统架构

### 数据模型

#### 剧集元数据
```
1. Title - 标题
2. Origin title - 原始标题
3. Douban id - 豆瓣ID
4. Imdb - IMDB ID
5. Type - 类型(Movie/TV Show)
6. Country - 国家
7. Language - 语言
8. Plot - 剧情简介
9. Poster - 海报
10. Director - 导演
11. Actor - 演员
12. Episode numbers - 集数
13. Season ID - 季ID
```

#### 订阅元数据
```
1. 订阅ID
2. 剧集元数据
3. 订阅URL
4. OTT平台
5. 分辨率
6. 更新策略（Cron表达式）
7. 发布集数（可选）
8. PT站分集种子ID列表
9. 订阅状态（更新/完结/已打包）
```

### 核心模块

#### 订阅模块
- 自动抓取元数据，支持手动修改
- 平台选择和订阅管理

#### 定时器
- 基于Cron表达式的定时触发机制
- 事件驱动的任务处理

#### 事件处理
- 完结状态判断
- OTT平台剧集列表抓取
- 缺集检测和下载链接获取

#### 下载器
- 队列式任务处理
- 失败记录和重试机制
- 标准化的文件存储结构

#### 目录监控
- 新文件检测和事件通知

#### 文件处理
- 智能重命名
- 文件转移
- 种子制作

#### 发布系统
- 发种队列管理
- 状态跟踪和重试
- 做种任务自动添加

#### 打包系统
- 完结内容的打包处理
- 全集发布支持

## 目录结构

```
download/                # 下载目录
├── 订阅ID/              # 按订阅ID组织的下载内容
│   └── 集数.mp4         # 下载的视频文件

create_torrent/          # 种子制作目录
├── 时间戳+随机数/        # 每次制种的临时目录
│   └── 剧集文件夹名/     # 剧集目录
│       └── 剧集文件      # 处理后的剧集文件

torrents/                # 种子文件存储目录
└── uuid.torrent         # 制作的种子文件
```

## 工作流程

1. **订阅流程**：添加订阅 → 抓取元数据 → 设置更新策略
2. **更新检测**：定时器触发 → 检查OTT平台更新 → 检测缺失剧集 → 获取下载链接
3. **下载处理**：队列下载 → 失败重试 → 文件存储
4. **文件处理**：检测新文件 → 重命名和转移 → 制作种子
5. **发布流程**：加入发种队列 → 发布到PT站 → 添加做种任务
6. **完结处理**：检测完结状态 → 添加到打包队列 → 制作全集种子 → 发布

## 开发计划

- [ ] 基础架构搭建
- [ ] 剧集元数据管理模块
- [ ] 订阅系统开发
- [ ] 下载模块实现
- [ ] 文件处理系统
- [ ] 发布系统集成
- [ ] 用户界面开发
- [ ] 多平台支持扩展
